{"ast":null,"code":"import React,{useState,useEffect}from'react';import SubTaskRow from'./SubTaskRow';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const TaskRow=_ref=>{let{task,level=1,isExpanded,onToggleExpand,onDeleteTask,refreshTrigger}=_ref;const[subtasks,setSubtasks]=useState([]);const[loadingSubtasks,setLoadingSubtasks]=useState(false);const navigate=useNavigate();const taskId=task.id||task.taskId;useEffect(()=>{if(isExpanded&&subtasks.length===0){fetchSubtasksForTask();}},[isExpanded]);// Refetch subtasks when refreshTrigger changes and task is expanded\nuseEffect(()=>{if(isExpanded&&refreshTrigger>0){fetchSubtasksForTask();}},[refreshTrigger]);// Refetch subtasks when refreshTrigger changes and task is expanded\nuseEffect(()=>{if(isExpanded&&refreshTrigger>0){fetchSubtasksForTask();}},[refreshTrigger]);const fetchSubtasksForTask=async()=>{try{setLoadingSubtasks(true);console.log(\"Fetching subtasks for task \".concat(taskId,\"...\"));const response=await fetch(\"/tasks/\".concat(taskId,\"/subtasks\"));if(!response.ok){throw new Error('Failed to fetch subtasks for task');}const taskSubtasks=await response.json();console.log(\"Found \".concat(taskSubtasks.length,\" subtasks for task \").concat(taskId,\":\"),taskSubtasks);setSubtasks(taskSubtasks);}catch(error){console.error('Error fetching subtasks for task:',error);setSubtasks([]);}finally{setLoadingSubtasks(false);}};const handleTaskClick=()=>{onToggleExpand(taskId);};const handleEdit=()=>{navigate(\"/edit-task\",{state:{task}});};const handleDelete=()=>{onDeleteTask(task);};const handleAddSubtask=()=>{navigate(\"/add-subtask/\".concat(taskId));};const hasSubtasks=task.type==='story'||task.type==='task';const indentClass=\"task-row level-\".concat(level);// Helper function to format estimate as days\nconst formatEstimateAsDays=originalEstimate=>{if(!originalEstimate)return'N/A';if(typeof originalEstimate==='string'){if(originalEstimate.startsWith('P')&&originalEstimate.endsWith('D')){const days=originalEstimate.substring(1,originalEstimate.length-1);return\"\".concat(days,\" days\");}return originalEstimate;}if(typeof originalEstimate==='object'){if(originalEstimate.seconds!==undefined){const hours=originalEstimate.seconds/3600;const days=(hours/8).toFixed(1);return\"\".concat(days,\" days\");}return JSON.stringify(originalEstimate);}return originalEstimate.toString();};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{className:indentClass,children:[/*#__PURE__*/_jsx(\"td\",{className:\"expand-column\",children:hasSubtasks&&/*#__PURE__*/_jsx(\"button\",{className:\"expand-button \".concat(isExpanded?'expanded':''),onClick:handleTaskClick,title:isExpanded?'Collapse':'Expand',children:isExpanded?'▼':'▶'})}),/*#__PURE__*/_jsxs(\"td\",{className:\"task-title level-\".concat(level),children:[task.title,hasSubtasks&&/*#__PURE__*/_jsx(\"button\",{onClick:handleAddSubtask,className:\"add-subtask-btn\",title:\"Add Subtask\",style:{marginLeft:'10px',fontSize:'12px',padding:'2px 4px'},children:\"+ Add Subtask\"})]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"type-badge \".concat(task.type,\"-badge\"),children:task.type})}),/*#__PURE__*/_jsx(\"td\",{children:task.status}),/*#__PURE__*/_jsx(\"td\",{children:task.priority}),/*#__PURE__*/_jsx(\"td\",{children:task.assigneeId||'Unassigned'}),/*#__PURE__*/_jsx(\"td\",{children:task.startDate}),/*#__PURE__*/_jsx(\"td\",{children:task.dueDate||'N/A'}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleEdit,className:\"button-list edit-btn\",children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDelete,className:\"button-list delete-btn\",children:\"Delete\"})]})})]}),isExpanded&&hasSubtasks&&/*#__PURE__*/_jsx(_Fragment,{children:loadingSubtasks?/*#__PURE__*/_jsx(\"tr\",{className:\"loading-row\",children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"9\",className:\"loading-cell\",children:\"Loading subtasks...\"})}):subtasks.length===0?/*#__PURE__*/_jsx(\"tr\",{className:\"empty-row\",children:/*#__PURE__*/_jsxs(\"td\",{colSpan:\"9\",className:\"empty-cell\",children:[\"No subtasks found under this \",task.type,\".\"]})}):subtasks.map(subtask=>/*#__PURE__*/_jsx(SubTaskRow,{subtask:subtask,level:level+1,onDeleteTask:onDeleteTask},subtask.id||subtask.taskId))})]});};export default TaskRow;","map":{"version":3,"names":["React","useState","useEffect","SubTaskRow","useNavigate","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","TaskRow","_ref","task","level","isExpanded","onToggleExpand","onDeleteTask","refreshTrigger","subtasks","setSubtasks","loadingSubtasks","setLoadingSubtasks","navigate","taskId","id","length","fetchSubtasksForTask","console","log","concat","response","fetch","ok","Error","taskSubtasks","json","error","handleTaskClick","handleEdit","state","handleDelete","handleAddSubtask","hasSubtasks","type","indentClass","formatEstimateAsDays","originalEstimate","startsWith","endsWith","days","substring","seconds","undefined","hours","toFixed","JSON","stringify","toString","children","className","onClick","title","style","marginLeft","fontSize","padding","status","priority","assigneeId","startDate","dueDate","colSpan","map","subtask"],"sources":["/home/abd_faiyaz/ontik_project_1/Gantt_project_v1/src/main/resources/static/React_Frontend/frontend/src/components/TaskRow.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport SubTaskRow from './SubTaskRow';\nimport { useNavigate } from 'react-router-dom';\n\nconst TaskRow = ({ task, level = 1, isExpanded, onToggleExpand, onDeleteTask, refreshTrigger }) => {\n  const [subtasks, setSubtasks] = useState([]);\n  const [loadingSubtasks, setLoadingSubtasks] = useState(false);\n  const navigate = useNavigate();\n\n  const taskId = task.id || task.taskId;\n\n  useEffect(() => {\n    if (isExpanded && subtasks.length === 0) {\n      fetchSubtasksForTask();\n    }\n  }, [isExpanded]);\n\n  // Refetch subtasks when refreshTrigger changes and task is expanded\n  useEffect(() => {\n    if (isExpanded && refreshTrigger > 0) {\n      fetchSubtasksForTask();\n    }\n  }, [refreshTrigger]);\n\n  // Refetch subtasks when refreshTrigger changes and task is expanded\n  useEffect(() => {\n    if (isExpanded && refreshTrigger > 0) {\n      fetchSubtasksForTask();\n    }\n  }, [refreshTrigger]);\n\n  const fetchSubtasksForTask = async () => {\n    try {\n      setLoadingSubtasks(true);\n      console.log(`Fetching subtasks for task ${taskId}...`);\n      \n      const response = await fetch(`/tasks/${taskId}/subtasks`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch subtasks for task');\n      }\n\n      const taskSubtasks = await response.json();\n      console.log(`Found ${taskSubtasks.length} subtasks for task ${taskId}:`, taskSubtasks);\n      setSubtasks(taskSubtasks);\n    } catch (error) {\n      console.error('Error fetching subtasks for task:', error);\n      setSubtasks([]);\n    } finally {\n      setLoadingSubtasks(false);\n    }\n  };\n\n  const handleTaskClick = () => {\n    onToggleExpand(taskId);\n  };\n\n  const handleEdit = () => {\n    navigate(\"/edit-task\", { state: { task } });\n  };\n\n  const handleDelete = () => {\n    onDeleteTask(task);\n  };\n\n  const handleAddSubtask = () => {\n    navigate(`/add-subtask/${taskId}`);\n  };\n\n  const hasSubtasks = task.type === 'story' || task.type === 'task';\n  const indentClass = `task-row level-${level}`;\n\n  // Helper function to format estimate as days\n  const formatEstimateAsDays = (originalEstimate) => {\n    if (!originalEstimate) return 'N/A';\n    \n    if (typeof originalEstimate === 'string') {\n      if (originalEstimate.startsWith('P') && originalEstimate.endsWith('D')) {\n        const days = originalEstimate.substring(1, originalEstimate.length - 1);\n        return `${days} days`;\n      }\n      return originalEstimate;\n    }\n    \n    if (typeof originalEstimate === 'object') {\n      if (originalEstimate.seconds !== undefined) {\n        const hours = originalEstimate.seconds / 3600;\n        const days = (hours / 8).toFixed(1);\n        return `${days} days`;\n      }\n      return JSON.stringify(originalEstimate);\n    }\n    \n    return originalEstimate.toString();\n  };\n\n  return (\n    <>\n      {/* Task/Story Row */}\n      <tr className={indentClass}>\n        <td className=\"expand-column\">\n          {hasSubtasks && (\n            <button\n              className={`expand-button ${isExpanded ? 'expanded' : ''}`}\n              onClick={handleTaskClick}\n              title={isExpanded ? 'Collapse' : 'Expand'}\n            >\n              {isExpanded ? '▼' : '▶'}\n            </button>\n          )}\n        </td>\n        <td className={`task-title level-${level}`}>\n          {task.title}\n          {hasSubtasks && (\n            <button \n              onClick={handleAddSubtask}\n              className=\"add-subtask-btn\"\n              title=\"Add Subtask\"\n              style={{ marginLeft: '10px', fontSize: '12px', padding: '2px 4px' }}\n            >\n              + Add Subtask\n            </button>\n          )}\n        </td>\n        <td>\n          <span className={`type-badge ${task.type}-badge`}>{task.type}</span>\n        </td>\n        <td>{task.status}</td>\n        <td>{task.priority}</td>\n        <td>{task.assigneeId || 'Unassigned'}</td>\n        <td>{task.startDate}</td>\n        <td>{task.dueDate || 'N/A'}</td>\n        <td>\n          <div className=\"button-container\">\n            <button onClick={handleEdit} className=\"button-list edit-btn\">Edit</button>\n            <button onClick={handleDelete} className=\"button-list delete-btn\">Delete</button>\n          </div>\n        </td>\n      </tr>\n\n      {/* Expanded Subtasks */}\n      {isExpanded && hasSubtasks && (\n        <>\n          {loadingSubtasks ? (\n            <tr className=\"loading-row\">\n              <td colSpan=\"9\" className=\"loading-cell\">\n                Loading subtasks...\n              </td>\n            </tr>\n          ) : subtasks.length === 0 ? (\n            <tr className=\"empty-row\">\n              <td colSpan=\"9\" className=\"empty-cell\">\n                No subtasks found under this {task.type}.\n              </td>\n            </tr>\n          ) : (\n            subtasks.map((subtask) => (\n              <SubTaskRow\n                key={subtask.id || subtask.taskId}\n                subtask={subtask}\n                level={level + 1}\n                onDeleteTask={onDeleteTask}\n              />\n            ))\n          )}\n        </>\n      )}\n    </>\n  );\n};\n\nexport default TaskRow;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}